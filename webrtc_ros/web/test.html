<html>
<head>
<title>WebRTC ROS</title>
<script>
  RTCPeerConnection = window.mozRTCPeerConnection || window.webkitRTCPeerConnection;
  RTCSessionDescription = window.mozRTCSessionDescription || window.RTCSessionDescription;
  RTCIceCandidate = window.mozRTCIceCandidate || window.RTCIceCandidate;
  navigator.getUserMedia = navigator.mozGetUserMedia || navigator.webkitGetUserMedia;
  URL = window.webkitURL || window.URL;
</script>
<script type="text/javascript" src="/webrtc_ros.js"></script>
<script>
  var connection = WebrtcRos.createConnection();
  function configure() {
    subscribed_video_topic_name = document.getElementById("subscribed_video_topic_name").value;
    published_video_topic_name = document.getElementById("publish_video").checked ? document.getElementById("published_video_topic_name").value : "";
    config = {
      "subscribed_video_topic": subscribed_video_topic_name,
      "published_video_topic": published_video_topic_name
    };
    connection.configure(config);
  };
  connection.onSignalingOpen = function(){
    console.log("Signaling open");
  };
  connection.onSignalingError = function(error){
    console.error("Error opening signaling channel", error);
  };
  connection.onRemoteStreamAdded = function(event) {
    console.log("Remote stream added:", URL.createObjectURL(event.stream));
    var remoteVideoElement = document.getElementById('remote-video');
    remoteVideoElement.src = URL.createObjectURL(event.stream);
    remoteVideoElement.play();
  }
  connection.onRemoteStreamRemoved = function(event) {
    console.log("Remote stream removed");
  }
</script>
</head>
<body>
    <div id="container">
        <video id="remote-video"></video>
	<br>
	<form  onsubmit="configure();return false;">
	  Subscribed Video Topic: <input type="text" id="subscribed_video_topic_name" value="/camera/image_raw">
	  <br>
	  Published Video Topic:
	  <input type="checkbox" id="publish_video">
	  <input type="text" id="published_video_topic_name" value="/webrtc_video/image_raw">
	  <br>
	  <input type="submit" value="Configure">
	</form>
    </div>
</body>
</html>
